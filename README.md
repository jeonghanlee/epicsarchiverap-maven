# EPICS Archiver Appliance with Maven

A Maven-based build system for the EPICS Archiver Appliance.

**Warning:** This is a specialized Maven configuration, currently under refinement. It will be integrated with [jeonghanlee/epicsarchiverap-env](https://github.com/jeonghanlee/epicsarchiverap-env).

## Overview

This project provides a Maven `pom.xml` to compile and package the Archiver Appliance. By default, it focuses on artifact generation and may bypass extensive test suites.

## Prerequisites

* **JDK 21+**: Java Development Kit version 21 or newer is required.
* **Apache Maven**: A recent version (e.g., 3.9.x).
    * For easy Java/Maven setup, see [jeonghanlee/java-env](https://github.com/jeonghanlee/java-env).
* **Git**: Required for generating release notes from commit history (this is part of the documentation generation process).
* **Operating System**:
    * Core build (JARs/WARs) is generally OS-agnostic.
    * Sphinx documentation (`build_docs.sh`) is primarily for Linux.
* **Sphinx Tools**: If building Sphinx documentation (which is enabled by default), ensure Sphinx, Python, and any necessary themes/extensions are installed and configured.

## Build Instructions

Execute these commands from the project's root directory (where `pom.xml` is located).

### Standard Build (Package/Install)

This command cleans the project, compiles the code, and packages it into `JAR/WAR` files located in the `target/` directory.

```bash
mvn clean package
```

To also install the artifacts into your local Maven repository (for use by other local projects):

```bash
mvn clean install
```


### Controlling Sphinx Documentation Generation

By default, Sphinx documentation is built as part of the package goal.

To skip the Sphinx documentation build (e.g., for a quicker development build after it has been built once):

```bash
mvn clean package -Dsphinx.skip=true
```
Note: Several files generated by the `Javadoc/taglet` flow (e.g., `mgmtpathmappings.txt`, `mgmt_scriptables.txt`, `mgmt_scriptables.html`) are created before Sphinx and are required for the successful build of the WAR files. These steps will run even if Sphinx itself is skipped with `-Dsphinx.skip=true`.


### Using a Specific `java-env`
If you use java-env or need to specify the JDK/Maven paths:

```bash
JAVA_HOME=/opt/java-env/JDK /opt/java-env/MAVEN/bin/mvn clean package
```
**Important:** Ensure `JAVA_HOME` points to a **JDK 21+** installation.

## Output Artifacts
* Packaged Application (`WARs/JARs`): Found in the `target/` directory.
* Javadoc API Documentation: Found in the the `target/site/apidocs`.
* Sphinx HTML Documentation: If built, usually in `docs/docs/build`.
* Assembly Package: If configured, often found in `target/archappl_v<VERSION>.tar.gz` (e.g., `target/archappl_v2025-06-01-rev1-LBNL-ALS-U.tar.gz`).

## Troubleshooting

* Java Version Errors (`UnsupportedClassVersionError`): Ensure your `JAVA_HOME`, `PATH`, and the java command used by Maven all refer to JDK 21 or newer. Check with `java -version`.
* File Not Found / Other Issues: Run your Maven command with `-e` (for detailed errors) and `-X` (for debug logging) to get more information. For example: `mvn clean package -e -X`.

